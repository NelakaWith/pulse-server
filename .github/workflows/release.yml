name: Release
on:
    push:
        tags:
            - "v*.*.*"
jobs:
    create-release:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v4
            - name: Create GitHub Release
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
              run: |
                  VERSION=${GITHUB_REF#refs/tags/}
                  CHANGELOG_CONTENT=$(sed -n "/## [${VERSION}]/,/## [/p" CHANGELOG.md | head -n -1)
                  if [ -z "$CHANGELOG_CONTENT" ]; then
                    CHANGELOG_CONTENT="Release $VERSION"
                  fi
                  gh release create "$VERSION" --title "$VERSION" --notes "$CHANGELOG_CONTENT"
